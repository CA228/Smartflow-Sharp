<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <title>Smartflow-Sharp业务流程设计器</title>
    <link href="../content/layui/css/layui.css" rel="stylesheet" />
    <link href="../content/wf/icon/iconfont.css" rel="stylesheet" />
    <link href="../content/wf/design/smartflow.css" rel="stylesheet" />
    <link href="../content/wf/select2/css/select2.min.css" rel="stylesheet" />
    <link href="../content/wf/ztree/zTreeStyle/zTreeStyle.css" rel="stylesheet" />
    <script src="../content/jquery.min.js"></script>
    <script src="../content/wf/select2/js/select2.full.min.js"></script>
    <script src="../content/wf/select2/js/i18n/zh-CN.js"></script>
    <script src="../content/wf/design/svg.js"></script>
    <script src="../content/layui/layui.all.js"></script>
    <script src="../content/wf/design/smartflow.js"></script>
    <script src="../content/wf/ztree/jquery.ztree.all.min.js"></script>
    <script src="../content/base64.min.js"></script>
    <script src="../content/common.js"></script>
</head>
<body>
    <div class="container_tools">
        <ul class="tools_menu clearfix" id="menus">
            <li command="saveas">
                <span class="iconfont iconsave7" title="另存为"></span>
            </li>
            <li command="save">
                <span class="iconfont iconsave5" title="保存"></span>
            </li>
            <li command="select">
                <span class="iconfont iconshubiaojiantou" title="选择"></span>
            </li>
            <li command="line">
                <span class="iconfont iconline icon-line" title="连线"></span>
            </li>
            <li command="node">
                <span class="iconfont iconweibiaoti-zhuanhuan-" title="节点"></span>
            </li>
            <li command="decision">
                <span class="iconfont iconlingxing icon-decision" title="判断节点"></span>
            </li>
            <li command="fork">
                <span class="iconfont iconchangfangxing2 icon-fork" title="分叉"></span>
            </li>
            <li command="join">
                <span class="iconfont iconyuanxing1" title="聚合"></span>
            </li>
        </ul>
    </div>
    <div class="container container_right" id="attributes_tabs">
        <div id="workflow-help" class="attributes_tab">
            <table class="attribute_tab_table">
                <tr>
                    <td class="attribute_tab_table_column">方向</td>
                    <td class="attribute_tab_table_content">流程设计工具支持上下左右</td>
                </tr>
                <tr>
                    <td class="attribute_tab_table_column">连线</td>
                    <td class="attribute_tab_table_content">先点击左边线条图标，然后选中节点，移动到连线节点双击鼠标右键</td>
                </tr>
                <tr>
                    <td class="attribute_tab_table_column">描点</td>
                    <td class="attribute_tab_table_content">先连线，连线完成后，按住Ctrl+Shift键，然后鼠标双击线条，就会出圆点，可以随意拖动</td>
                </tr>
                <tr>
                    <td class="attribute_tab_table_column">移动</td>
                    <td class="attribute_tab_table_content">先点击左边鼠标箭头，然后选择节点元素，按下鼠标左键进行移动</td>
                </tr>
                <tr>
                    <td class="attribute_tab_table_column">编辑</td>
                    <td class="attribute_tab_table_content">鼠标双击元素，编辑右边面板</td>
                </tr>
                <tr>
                    <td class="attribute_tab_table_column">删除</td>
                    <td class="attribute_tab_table_content">按住键盘中Ctrl+Alt键，然后鼠标双击元素，元素就会被删除</td>
                </tr>
            </table>
        </div>
        <div id="workflow-node" class="attributes_tab hide">
            <form class="layui-form" lay-filter="form_node">
                <div class="layui-form-item">
                    <label class="smartflow-label">节点名称</label>
                    <div>
                        <input type="text" autocomplete="off" placeholder="节点名称" class="layui-input" id="node_name" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="smartflow-label">节点编码</label>
                    <div>
                        <input type="text" autocomplete="off" placeholder="节点编码" class="layui-input" id="node_id" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="smartflow-label">节点类型</label>
                    <div>
                        <select autocomplete="off" placeholder="节点类型" lay-filter="node_category"  class="layui-select" id="node_category">
                            <option value="node">普通节点</option>
                            <option value="collaboration">会签节点</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="smartflow-label">参与单位</label>
                    <div>
                        <select id="node_organization" class="layui-input select2" style="width:100%;height:38px;" lay-ignore></select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="smartflow-label">参与角色</label>
                    <div>
                        <select id="node_group" class="layui-input select2" style="width:100%;height:38px;" lay-ignore></select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="smartflow-label">参与人</label>
                    <div>
                        <select id="node_user" class="layui-input select2" style="width:100%;height:38px;" lay-ignore></select>
                    </div>
                </div>
            </form>
        </div>
        <div id="workflow-line" class="attributes_tab hide">
            <form class="layui-form" lay-filter="form_line">
                <div class="layui-form-item">
                    <label class="smartflow-label">操作名称</label>
                    <div>
                        <input type="text" placeholder="操作名称" class="layui-input" id="line_name" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="smartflow-label">操作编码</label>
                    <div>
                        <input type="text" placeholder="操作编码" class="layui-input" id="line_id" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="smartflow-label">操作顺序</label>
                    <div>
                        <input type="text" placeholder="顺序" class="layui-input" id="line_order" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="smartflow-label">表单</label>
                    <div>
                        <input type="text" placeholder="表单url" class="layui-input" id="line_url" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="smartflow-label">表达式</label>
                    <div>
                        <input type="text" placeholder="表达式" class="layui-input" id="line_expression" />
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="container_ctr">
        <div class="container_draw" id="drawing"></div>
    </div>
    <script type="text/html" id="smartflow_s_info">
        <form class="layui-form" lay-filter="layui_flow_info" style="margin:10px;margin-right:30px;">
            <div class="layui-form-item">
                <label class="layui-form-label">流程名称</label>
                <div class="layui-input-block">
                    <input type="text" autocomplete="off" placeholder="流程名称" name="Name" class="layui-input" />
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">业务类型</label>
                <div class="layui-input-block" style="position:relative;">
                    <input type="text" id="txtCategoryName" name="CategoryName" onclick="$('#zc').show()" class="layui-input" />
                    <input type="hidden" id="hidCategoryCode" name="CategoryCode" />
                    <div class="ztree-container" id="zc" onmouseleave="$('#zc').hide()">
                        <div class="ztree" id="ztree"></div>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block">
                    <textarea class="layui-textarea" autocomplete="off" name="Memo" style="min-height:60px;"></textarea>
                </div>
            </div>
        </form>
    </script>
    <script type="text/html" id="smartflow_e_info">
        <form class="layui-form" lay-filter="layui_flow_info" style="margin:10px;margin-right:30px;">
            <div class="layui-form-item">
                <label class="layui-form-label">流程名称</label>
                <div class="layui-input-block">
                    <input type="text" placeholder="流程名称" name="Name" class="layui-input" />
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block">
                    <textarea class="layui-textarea" name="Memo" style="min-height:60px;"></textarea>
                </div>
            </div>
        </form>
    </script>
    <script src="../content/wf/design/design.js"></script>
    <script type="text/javascript">
        $(function () {
            const setting = design.Configuration({
                node: 'workflow-node',
                line: 'workflow-line',
                help: 'workflow-help',
                container: 'drawing',
                categoryUrl: 'api/setting/category/list',
                categoryId: 'ztree',
                url: 'api/wf/template/{id}/info',
                save: 'api/wf/template/persist',
                saveAs: 'api/wf/template/saveas'
            });
            $("#menus li").click(function () {
                var command = $(this).attr("command");
                var instance = $.SMF.getInstanceComponent();
                if ($.inArray(command, ['node', 'fork', 'join', 'decision','collaboration']) > -1) {
                    instance.create(command);
                } else {
                    if (command === 'line') {
                        instance.join();
                    } else {
                        if (instance[command]) {
                            instance[command]();
                        } else {
                            setting[command]();
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
